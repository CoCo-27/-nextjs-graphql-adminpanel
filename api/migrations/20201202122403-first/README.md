# Migration `20201202122403-first`

This migration has been generated by Vikas Dwivedi at 12/2/2020, 12:24:03 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `next_graphql_admin`.`Card` (
    `brand` varchar(191) NOT NULL  ,
    `expMonth` int NOT NULL  ,
    `expYear` int NOT NULL  ,
    `id` varchar(191) NOT NULL  ,
    `last4Digits` varchar(191) NOT NULL  ,
    `stripePaymentMethodId` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `next_graphql_admin`.`GoogleMapsLocation` (
    `googlePlacesId` varchar(191) NOT NULL  ,
    `id` varchar(191) NOT NULL  ,
    `name` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `next_graphql_admin`.`OrderDetail` (
    `googleMapsLocationId` varchar(191)  ,
    `id` varchar(191) NOT NULL  ,
    `userId` varchar(191)  ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `next_graphql_admin`.`Product` (
    `category` varchar(191) NOT NULL ,
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `description` varchar(191) NOT NULL  ,
    `discount` int NOT NULL  ,
    `id` varchar(191) NOT NULL  ,
    `name` varchar(191) NOT NULL  ,
    `price` int NOT NULL  ,
    `salePrice` int NOT NULL  ,
    `sku` varchar(191) NOT NULL  ,
    `unit` varchar(191) NOT NULL  ,
    `updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `user` varchar(191) NOT NULL ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `next_graphql_admin`.`ProductImage` (
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `id` varchar(191) NOT NULL  ,
    `image` varchar(191) NOT NULL  ,
    `productId` varchar(191) NOT NULL ,
    `updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `next_graphql_admin`.`User` (
    `billing` varchar(191)   ,
    `email` varchar(191) NOT NULL  ,
    `emailConfirmationToken` varchar(191)   ,
    `googleId` varchar(191)   ,
    `hasCompletedOnboarding` boolean NOT NULL DEFAULT false ,
    `hasVerifiedEmail` boolean   ,
    `id` varchar(191) NOT NULL  ,
    `name` varchar(191) NOT NULL  ,
    `password` varchar(191)   ,
    `resetToken` varchar(191)   ,
    `resetTokenExpiry` Decimal(65,30)   ,
    `role` ENUM('USER', 'ADMIN', 'MANAGER') NOT NULL DEFAULT 'USER' ,
    `status` ENUM('INACTIVE', 'ACTIVE', 'BLOCKED') NOT NULL DEFAULT 'ACTIVE' ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `next_graphql_admin`.`CartItem` (
    `id` varchar(191) NOT NULL  ,
    `item` varchar(191) NOT NULL  ,
    `productId` varchar(191)  ,
    `quantity` int NOT NULL  ,
    `user` varchar(191) NOT NULL ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `next_graphql_admin`.`Category` (
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `id` varchar(191) NOT NULL  ,
    `name` varchar(191) NOT NULL  ,
    `parent` varchar(191) NOT NULL  ,
    `slug` varchar(191) NOT NULL  ,
    `updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `Product.sku` ON `next_graphql_admin`.`Product`(`sku`)

CREATE  INDEX `category` ON `next_graphql_admin`.`Product`(`category`)

CREATE  INDEX `user` ON `next_graphql_admin`.`Product`(`user`)

CREATE  INDEX `ProductImage_ibfk_1` ON `next_graphql_admin`.`ProductImage`(`productId`)

CREATE UNIQUE INDEX `User.email` ON `next_graphql_admin`.`User`(`email`)

CREATE UNIQUE INDEX `User.googleId` ON `next_graphql_admin`.`User`(`googleId`)

CREATE  INDEX `item` ON `next_graphql_admin`.`CartItem`(`item`)

CREATE  INDEX `user` ON `next_graphql_admin`.`CartItem`(`user`)

CREATE UNIQUE INDEX `Category.slug` ON `next_graphql_admin`.`Category`(`slug`)

ALTER TABLE `next_graphql_admin`.`OrderDetail` ADD FOREIGN KEY (`userId`) REFERENCES `next_graphql_admin`.`User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `next_graphql_admin`.`OrderDetail` ADD FOREIGN KEY (`googleMapsLocationId`) REFERENCES `next_graphql_admin`.`GoogleMapsLocation`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `next_graphql_admin`.`Product` ADD FOREIGN KEY (`category`) REFERENCES `next_graphql_admin`.`Category`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `next_graphql_admin`.`Product` ADD FOREIGN KEY (`user`) REFERENCES `next_graphql_admin`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `next_graphql_admin`.`ProductImage` ADD FOREIGN KEY (`productId`) REFERENCES `next_graphql_admin`.`Product`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `next_graphql_admin`.`CartItem` ADD FOREIGN KEY (`user`) REFERENCES `next_graphql_admin`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `next_graphql_admin`.`CartItem` ADD FOREIGN KEY (`productId`) REFERENCES `next_graphql_admin`.`Product`(`id`) ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201202122403-first
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,122 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "mysql"
+  url      = env("API_DATABASE_URL")
+}
+
+model Card {
+  brand                 String
+  expMonth              Int
+  expYear               Int
+  id                    String @id @default(cuid())
+  last4Digits           String
+  stripePaymentMethodId String
+}
+
+model GoogleMapsLocation {
+  googlePlacesId String
+  id             String        @id @default(cuid())
+  name           String
+  OrderDetail    OrderDetail[]
+}
+
+model OrderDetail {
+
+  id                   String              @id @default(cuid())
+  googleMapsLocationId String?
+  User                 User?               @relation(fields: [userId], references: [id])
+  userId               String?
+  GoogleMapsLocation   GoogleMapsLocation? @relation(fields: [googleMapsLocationId], references: [id])
+
+}
+
+model Product {
+  category      String
+  createdAt     DateTime       @default(now())
+  description   String
+  discount      Int
+  id            String         @id @default(cuid())
+  name          String
+  price         Int
+  salePrice     Int
+  sku           String         @unique
+  unit          String
+  updatedAt     DateTime       @default(now())
+  user          String
+  Category      Category       @relation(fields: [category], references: [id])
+  User          User           @relation(fields: [user], references: [id])
+  CartItem      CartItem[]
+  ProductImages ProductImage[]
+
+  @@index([category], name: "category")
+  @@index([user], name: "user")
+}
+
+model ProductImage {
+  createdAt DateTime @default(now())
+  id        String   @id @default(cuid())
+  image     String
+  productId String
+  updatedAt DateTime @default(now())
+  Product   Product  @relation(fields: [productId], references: [id])
+
+  @@index([productId], name: "ProductImage_ibfk_1")
+}
+
+enum User_role {
+  USER
+  ADMIN
+  MANAGER
+}
+
+enum User_status {
+  INACTIVE
+  ACTIVE
+  BLOCKED
+}
+
+model User {
+  name                   String
+  email                  String        @unique
+  emailConfirmationToken String?
+  googleId               String?       @unique
+  hasCompletedOnboarding Boolean       @default(false)
+  hasVerifiedEmail       Boolean?
+  id                     String        @id @default(cuid())
+  password               String?
+  resetToken             String?
+  resetTokenExpiry       Float?
+  role                   User_role     @default(USER)
+  status                 User_status   @default(ACTIVE)
+  billing                String?
+  CartItem               CartItem[]
+  Product                Product[]
+  OrderDetail            OrderDetail[]
+}
+
+//////////////////////////////////////////////////////
+model CartItem {
+  id       String @id
+  item     String
+  quantity Int
+  user     String
+  User     User   @relation(fields: [user], references: [id])
+
+  Product   Product? @relation(fields: [productId], references: [id])
+  productId String?
+  @@index([item], name: "item")
+  @@index([user], name: "user")
+}
+
+model Category {
+  createdAt DateTime  @default(now())
+  id        String    @id @default(cuid())
+  name      String
+  parent    String
+  slug      String    @unique
+  updatedAt DateTime  @default(now())
+  Product   Product[]
+}
```


